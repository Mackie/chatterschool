<!doctype html>
<html lang='en'>
<head>
    <meta charset='utf-8'>
    <title>Chatterschool</title>
    <link rel='shortcut icon' href='/static/favicon.ico' type='image/x-icon'>
    <link rel="stylesheet" href="/static/basic.css">
</head>
<body>
    <header>
        <h1 class="college">Chatterschool</h1>
    </header>
    <main>
        <div>
            <form id="form_message">
                <input type="text" name="message" id="message" />
                <input type="button" value="Send!" onclick="send()" />
            </form>
        </div>
        <div id="inbox" class="inbox" ></div>
    </main>
</body>
<script>
    {{$ip := .}}
    /**
     * Setup server connection and username
     **/     
    var host = {{$ip}}
    var port = 9001
    var sender = "Mustermann"

    var connection = new WebSocket("ws://"+ host + ":" + port);

    connection.onmessage = function (e) {
        var msg = JSON.parse(e.data);
        var div = document.getElementById('inbox');
        div.innerHTML +=  format(msg);
    };

    function send() {
        var msg = document.getElementById("message").value;
        connection.send(`{"text": "${msg}", "sender": "${sender}"}`);
    }

    function format(msg) {
        return `<div class="message-line">${msg.sender} >> ${msg.text}</div>`
    }
</script>
</html>